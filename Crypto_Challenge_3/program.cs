using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApp1
{
    class Program
    {
        //static string knownPlaintextCat = "CAT";
        //static string encryptedMessageCatText = "0000101100000100000110000000111100001110"; <= result, HELLO

        static string knownPlaintext = "A One-Time Mistake";
        static string encryptedMessageText = "000001100001011000001010000000010001101000000011000101110000101100000110000000000001110100010100000111000001011100001010000011100001001100000100000101010001001000010101000011100001001100000100000011000000000000001000000011110001001000000100000000100001001100000100000101010001000100000000000100100001010100010101000010010000010000000100000011110000010100001110000001110001100000001110000101000001001100001101000010000000011100000100000001000001100100010001000001000000001000010101000000000000111100000010000110000000001000001110000011000000110000000000000101010000100100000100000011110000001000001110000011000000110000000000000010000000111100001110000100110000010100000100000100110001010100001110000000100000100100001110000011100001001000000100000000000000101000000100000110000000110100000100000011110000011000010101000010010000001000001110000011000000110000000000000110000000111000010100000010010000000000010111000001000001010100001110000000110000010000000000000001110001010000010101000101000001001100001000000100100001010100000101000011100001010101001011010010110000010100000000000100100000100100001111000001000000000000001101000100100001010100000100000100010000100100000100000011110000010000001110000011110000100000001111000000100001001100011000000100010001010100001110000011110000111000001100000010000000001000001110000011110100101101001011000011110000010000011001000101010000001000001001000000000000110100001101000001000000111100000110000001000000001000001110000011010000111000001111000010010001010100010101000100010001001000000010000011100000110100001110000011110001001000001101000000000001001000001001000100100000110100000000000100100000100100001101000101000000111100000101000001100001001100000100000011110000010100001110000101010001000100001001000001010001001000001101000000000001001000001001000010000001010100010010000001000001011100000100000011110000011100001000000101110000010000000111000011100001010000010011000000000001001000001101000000000001001000001001000101010001011000001110000110110000010000010011000011100001010100010110000011100001010100001001000100110000010000000100000100100000110100000000000100100000100100000111000100100000110100000000000100100000100100010101000101100000111000010010000001000001011100000100000011110001101100000100000100110000111000001110000011110000010000000101000011100001010100011011000010000001000101000001";

        static void Main()
        {
            byte[] encryptedMessage = ConvertToByteArray(encryptedMessageText);

            for (int length = 1; length <= knownPlaintext.Length; length++)
            {
                string partialPlaintext = knownPlaintext.Substring(0, length);
                byte[] keyBytes = Encoding.ASCII.GetBytes(partialPlaintext);

                byte[] decryptedMessage = new byte[encryptedMessage.Length];
                for (int i = 0; i < encryptedMessage.Length; i++)
                {
                    decryptedMessage[i] = (byte)(encryptedMessage[i] ^ keyBytes[i % keyBytes.Length]);
                }

                string result = ConvertText(Encoding.ASCII.GetString(decryptedMessage));
                Console.WriteLine($"Using key '{partialPlaintext}': " + result);
                Console.WriteLine($"");
                Console.WriteLine($"");
            }
        }

        public static byte[] ConvertToByteArray(string encryptedMessage)
        {
            List<byte> byteList = new List<byte>();

            for (int i = 0; i < encryptedMessage.Length; i += 8)
            {
                string byteString = encryptedMessage.Substring(i, 8);
                byte b = Convert.ToByte(byteString, 2);
                byteList.Add(b);
            }

            return byteList.ToArray();
        }

        public static string ConvertText(string input)
        {
            string result = input;

            result = result.Replace("COMMA", ",");
            result = result.Replace("QUOTE", "\"");
            result = result.Replace("DOT", ".");
            result = result.Replace("QUESTIONMARK", "?");
            result = result.Replace("DASH", "-");
            result = result.Replace("COLON", ":");
            result = result.Replace("SLASH", "/");
            result = result.Replace("ONE", "1");
            result = result.Replace("TWO", "2");
            result = result.Replace("THREE", "3");
            result = result.Replace("FOUR", "4");
            result = result.Replace("FIVE", "5");
            result = result.Replace("SIX", "6");
            result = result.Replace("SEVEN", "7");
            result = result.Replace("EIGHT", "8");
            result = result.Replace("NINE", "9");
            result = result.Replace("TEN", "10");
            result = result.Replace("ZERO", "0");
            result = result.Replace("XX", "\n");

            return result;
        }
    }
}